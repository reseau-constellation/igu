import{d as fe,p as be,dE as pe,u as Ce,n as ge,r,q as f,s as T,v as M,a as h,c as O,w as s,x as xe,y as _e,z as Be,b as t,h as Ve,V as Ne,B as W,t as A,f as i,au as we,e as z,l as he,Q as Oe,R as d,S as De,L as j,bG as F,am as $,dF as Q,dG as ke,aw as H,W as J,er as K,ad as ye,ae as Se,i as Le,O as Te,ao as Ae,bs as je,A as $e,bt as Ge,m as Ie,I as Pe,க as Re}from"./index-CeU7FrQc.js";import{_ as Ue}from"./ChoisirStatut.vue_vue_type_script_setup_true_lang-yDilrrR_.js";import{d as qe}from"./SélecteurNuée.vue_vue_type_script_setup_true_lang-DMyiXjfF.js";const Ee={class:"text-center"},Qe=fe({__name:"NouvelleBd",emits:["nouvelle"],setup(Me,{emit:X}){const Y=X,c=be(),{மொழியாக்கம்_பயன்படுத்து:Z}=Re(),{$மொ:u}=Z(),ee=pe(),{isRtl:D}=Ce(),{mdAndUp:te}=ge(),k=r(!1),o=r(0),l=["cheminement","gabaritBd","gabaritNuée","noms","descriptions","motsClefs","licence","licenceContenu","statut","confirmation"],ne=f(()=>{switch(l[o.value]){case"cheminement":return"bds.nouvelle.titreCheminement";case"gabaritBd":return"bds.nouvelle.titreGabaritBd";case"gabaritNuée":return"bds.nouvelle.titreGabaritNuée";case"noms":return"bds.nouvelle.titreNoms";case"descriptions":return"bds.nouvelle.titreDescriptions";case"motsClefs":return"bds.nouvelle.titreMotsClefs";case"licence":return"bds.nouvelle.titreLicence";case"licenceContenu":return"bds.nouvelle.titreLicenceContenu";case"statut":return"bds.nouvelle.titreStatut";case"confirmation":return"bds.nouvelle.titreConfirmation";default:return""}}),ae=f(()=>{switch(l[o.value]){case"cheminement":return"bds.nouvelle.sousTitreCheminement";case"gabaritBd":return"bds.nouvelle.sousTitreGabaritBd";case"gabaritNuée":return"bds.nouvelle.sousTitreGabaritNuée";case"noms":return"bds.nouvelle.sousTitreNoms";case"descriptions":return"bds.nouvelle.sousTitreDescriptions";case"motsClefs":return"bds.nouvelle.sousTitreMotsClefs";case"licence":return"bds.nouvelle.sousTitreLicence";case"licenceContenu":return"bds.nouvelle.sousTitreLicenceContenu";case"statut":return"bds.nouvelle.sousTitreStatut";case"confirmation":return"bds.nouvelle.sousTitreConfirmation";default:return""}}),b=r(),G=n=>{b.value=n,o.value=l.indexOf(n==="bd"?"gabaritBd":"gabaritNuée")},ie=()=>{b.value="nouvelle",o.value=l.indexOf("noms")},le=()=>{switch(l[o.value]){case"gabaritBd":case"gabaritNuée":o.value=l.indexOf("licence");break;case"licence":o.value=l.indexOf(N.value?"statut":"licenceContenu");break;default:o.value++;break}},se=()=>{switch(l[o.value]){case"gabaritBd":case"gabaritNuée":case"noms":o.value=l.indexOf("cheminement");break;case"licence":o.value=l.indexOf(b.value==="bd"?"gabaritBd":b.value==="nuée"?"gabaritNuée":"motsClefs");break;case"statut":o.value=l.indexOf(N.value?"licence":"licenceContenu");break;default:o.value--;break}},I=f(()=>{switch(l[o.value]){case"cheminement":return{actif:!1,visible:!1};case"gabaritBd":return{actif:!!p.value,visible:!0};case"gabaritNuée":return{actif:!!x.value,visible:!0};case"noms":return{actif:Object.keys(C.value).length>0,visible:!0};case"licence":return{actif:!!v.value,visible:!0};case"licenceContenu":return{actif:!!m.value,visible:!0};case"confirmation":return{actif:!1,visible:!1};default:return{actif:!0,visible:!0}}}),P=f(()=>{switch(l[o.value]){case"cheminement":return{actif:!1,visible:!1};case"confirmation":return{actif:!w.value,visible:!0};default:return{actif:!0,visible:!0}}}),x=r(),p=r(),ue=async n=>{p.value=n},oe=async n=>{const e=await c.nuées.générerSchémaBdNuée({idNuée:n,licence:"ODbl-1_0"});e&&(x.value=e,v.value=e.licence,m.value=e.licenceContenu)},_=r(!0),C=r({}),re=n=>{C.value=n},B=r({}),ce=n=>{B.value=n},V=r([]),R=T(c.licences.suivreLicences),v=r(),N=r(!0),m=r(),y=T(c.bds.suivreLicenceBd,{idBd:p}),g=f(()=>y.value&&R.value?.[y.value]?.conditions.includes("partageÉgal"));M(()=>{g.value&&(v.value=y.value)});const S=T(c.bds.suivreLicenceContenuBd,{idBd:p}),U=f(()=>S.value&&R.value?.[S.value]?.conditions.includes("partageÉgal"));M(()=>{U.value&&(m.value=S.value)});const q=r({statut:"active"}),E=f(()=>{if(v.value)return{licenceChoisie:v.value}}),L=r(!0),w=r(!1),de=async()=>{w.value=!0;let n;if(b.value==="nouvelle"){if(!E.value)return;const{licenceChoisie:e}=E.value;if(n=await c.bds.créerBd({licence:e,licenceContenu:m.value}),!n)throw new Error("Bd non créée.");await c.bds.sauvegarderNomsBd({idBd:n,noms:Object.fromEntries(Object.entries(C.value))}),await c.bds.sauvegarderDescriptionsBd({idBd:n,descriptions:Object.fromEntries(Object.entries(B.value))}),await c.bds.ajouterMotsClefsBd({idBd:n,idsMotsClefs:V.value})}else if(b.value==="nuée"){if(!x.value)return;n=await c.bds.créerBdDeSchéma({schéma:x.value})}else{if(!p.value)return;n=await c.bds.copierBd({idBd:p.value,copierDonnées:_.value})}await c.bds.changerStatutBd({idBd:n,statut:q.value}),Y("nouvelle",n),ve(),L.value&&ee.push(encodeURI(`/données/bd/${encodeURIComponent(n)}`))},ve=()=>{C.value={},B.value={},v.value=void 0,m.value=void 0,V.value=[],o.value=0,w.value=!1,k.value=!1};return(n,e)=>(h(),O(Pe,{modelValue:k.value,"onUpdate:modelValue":e[14]||(e[14]=a=>k.value=a)},{activator:s(({props:a})=>[xe(n.$slots,"activator",_e(Be({props:a})))]),default:s(()=>[t(Ie,{class:"mx-auto","min-width":i(te)?750:300},{default:s(()=>[t(Ve,null,{default:s(()=>[t(Ne,{class:"text-h5 justify-space-between"},{default:s(()=>[W("span",null,A(i(u)(ne.value)),1)]),_:1}),t(we,null,{default:s(()=>[z(A(i(u)(ae.value)),1)]),_:1})]),_:1}),t(he,null,{default:s(()=>[t(Oe,{modelValue:o.value,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value=a),style:{"overflow-y":"scroll"}},{default:s(()=>[(h(),O(d,{key:l.indexOf("cheminement")},{default:s(()=>[t(De,null,{default:s(()=>[t(j,{"prepend-icon":"mdi-creation-outline","append-icon":i(D)?"mdi-chevron-left":"mdi-chevron-right",title:i(u)("bds.nouvelle.créerNouvelle"),onClick:e[0]||(e[0]=()=>ie())},null,8,["append-icon","title"]),t(j,{"prepend-icon":"mdi-table","append-icon":i(D)?"mdi-chevron-left":"mdi-chevron-right",title:i(u)("bds.nouvelle.copierDeBd"),onClick:e[1]||(e[1]=()=>G("bd"))},null,8,["append-icon","title"]),t(j,{"prepend-icon":"mdi-table-multiple","append-icon":i(D)?"mdi-chevron-left":"mdi-chevron-right",title:i(u)("bds.nouvelle.copierDeNuée"),onClick:e[2]||(e[2]=()=>G("nuée"))},null,8,["append-icon","title"])]),_:1})]),_:1})),t(d,{value:l.indexOf("gabaritBd")},{default:s(()=>[t(F,{multiples:!1,onSelectionnee:e[3]||(e[3]=a=>a[0]&&ue(a[0]))}),t($,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=a=>_.value=a),label:i(u)("bds.copier.copierDonnées"),color:"primary"},null,8,["modelValue","label"])]),_:1},8,["value"]),t(d,{value:l.indexOf("gabaritNuée")},{default:s(()=>[t(qe,{multiples:!1,onSelectionnee:e[5]||(e[5]=a=>a.length&&oe(a[0]))})]),_:1},8,["value"]),t(d,{value:l.indexOf("noms")},{default:s(()=>[t(Q,{"texte-aucun-nom":i(u)("communs.texteAucunNom"),"indice-langue":i(u)("communs.indiceLangue"),"etiquette-nom":i(u)("communs.étiquetteNom"),"indice-nom":i(u)("bds.nouvelle.texteIndiceNom"),"noms-initiaux":C.value,"autorisation-modification":!0,onAjusterNoms:re},null,8,["texte-aucun-nom","indice-langue","etiquette-nom","indice-nom","noms-initiaux"])]),_:1},8,["value"]),t(d,{value:l.indexOf("descriptions")},{default:s(()=>[t(Q,{"texte-aucun-nom":i(u)("bds.nouvelle.texteAucuneDescription"),"indice-langue":i(u)("communs.indiceLangue"),"etiquette-nom":i(u)("bds.nouvelle.texteÉtiquetteDescription"),"indice-nom":i(u)("bds.nouvelle.texteIndiceDescription"),"noms-initiaux":B.value,"autorisation-modification":!0,longue:"",onAjusterNoms:ce},null,8,["texte-aucun-nom","indice-langue","etiquette-nom","indice-nom","noms-initiaux"])]),_:1},8,["value"]),t(d,{value:5},{default:s(()=>[t(ke,{multiples:"",originaux:V.value,onSelectionnee:e[6]||(e[6]=a=>V.value=a)},null,8,["originaux"])]),_:1}),t(d,{value:l.indexOf("licence")},{default:s(()=>[g.value?(h(),O(H,{key:0,class:"mb-4",variant:"outlined",type:"info",density:"compact",title:i(u)("licences.titrePartageÉgale"),text:i(u)("licences.infoPartageÉgale")},null,8,["title","text"])):J("",!0),t(K,{licence:v.value,"permission-modifier":!g.value,onChangerLicence:e[7]||(e[7]=a=>v.value=a)},null,8,["licence","permission-modifier"]),ye(t($,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=a=>N.value=a),label:i(u)("licences.pareilPourContenu"),disabled:!!g.value,color:"primary"},null,8,["modelValue","label","disabled"]),[[Se,v.value]])]),_:1},8,["value"]),t(d,{value:l.indexOf("licenceContenu")},{default:s(()=>[U.value&&_.value?(h(),O(H,{key:0,class:"mb-4",variant:"outlined",type:"info",density:"compact",title:i(u)("licences.titrePartageÉgale"),text:i(u)("licences.infoPartageÉgale")},null,8,["title","text"])):J("",!0),t(K,{licence:m.value,"permission-modifier":!g.value,onChangerLicence:e[9]||(e[9]=a=>m.value=a)},null,8,["licence","permission-modifier"])]),_:1},8,["value"]),t(d,{value:l.indexOf("statut")},{default:s(()=>[t(Ue,{onChoisir:e[10]||(e[10]=a=>q.value=a)},{sélecteur:s(({choisirNouvelle:a})=>[t(F,{multiples:!1,onSelectionnee:me=>a(me[0])},null,8,["onSelectionnee"])]),_:1})]),_:1},8,["value"]),t(d,{value:l.indexOf("confirmation")},{default:s(()=>[W("div",Ee,[t(Le,{class:"mt-3",variant:"outlined",loading:w.value,onClick:e[11]||(e[11]=()=>de())},{default:s(()=>[z(A(i(u)("bds.nouvelle.texteBtnCréation")),1)]),_:1},8,["loading"]),t($,{modelValue:L.value,"onUpdate:modelValue":e[12]||(e[12]=a=>L.value=a),label:i(u)("bds.nouvelle.ouvrirAprèsCréation")},null,8,["modelValue","label"])])]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),t(Te),t(Ae,null,{default:s(()=>[t(je,{visible:P.value.visible,actif:P.value.actif,onRetour:se},null,8,["visible","actif"]),t($e),t(Ge,{visible:I.value.visible,actif:I.value.actif,onSuivant:le},null,8,["visible","actif"])]),_:1})]),_:1},8,["min-width"])]),_:3},8,["modelValue"]))}});export{Qe as _};
//# sourceMappingURL=NouvelleBd.vue_vue_type_script_setup_true_lang-BjbtNzY6.js.map
