import{i as Et,b as _t,c as Ge,e as xt,d as St,E as Ke,f as L,h as $t,j as At,S as Ot,k as Ct,l as ye,a as Oe,m as me,o as G,C as M,q as Tt,r as kt,A as Ce,t as Ut,W as jt,u as Pt,p as zt,v as Mt}from"./index-FsaKRh2d.js";import{d as Xe,a9 as Lt,c as q,p as Rt}from"./index-n8X8qB5B.js";var Te;(function(n){n.Accept="accept",n.Ignore="ignore",n.Reject="reject"})(Te||(Te={}));var ke;(function(n){n[n.FATAL_ALL=0]="FATAL_ALL",n[n.NO_FATAL=1]="NO_FATAL"})(ke||(ke={}));class Dt extends Error{code;props;constructor(e,t,r){super(e),this.code=t,this.name=r?.name??"CodeError",this.props=r??{}}}function Nt(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}function ve(n){if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")}function Ft(n){return new TextEncoder().encode(n)}function Bt(n){return new TextDecoder().decode(n)}function It(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<n.length;s++){var o=n.charAt(s),a=o.charCodeAt(0);if(t[a]!==255)throw new TypeError(o+" is ambiguous");t[a]=s}var i=n.length,h=n.charAt(0),m=Math.log(i)/Math.log(256),l=Math.log(256)/Math.log(i);function S(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";for(var d=0,E=0,f=0,b=c.length;f!==b&&c[f]===0;)f++,d++;for(var g=(b-f)*l+1>>>0,u=new Uint8Array(g);f!==b;){for(var w=c[f],_=0,p=g-1;(w!==0||_<E)&&p!==-1;p--,_++)w+=256*u[p]>>>0,u[p]=w%i>>>0,w=w/i>>>0;if(w!==0)throw new Error("Non-zero carry");E=_,f++}for(var v=g-E;v!==g&&u[v]===0;)v++;for(var P=h.repeat(d);v<g;++v)P+=n.charAt(u[v]);return P}function j(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;var d=0;if(c[d]!==" "){for(var E=0,f=0;c[d]===h;)E++,d++;for(var b=(c.length-d)*m+1>>>0,g=new Uint8Array(b);c[d];){var u=t[c.charCodeAt(d)];if(u===255)return;for(var w=0,_=b-1;(u!==0||w<f)&&_!==-1;_--,w++)u+=i*g[_]>>>0,g[_]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");f=w,d++}if(c[d]!==" "){for(var p=b-f;p!==b&&g[p]===0;)p++;for(var v=new Uint8Array(E+(b-p)),P=E;p!==b;)v[P++]=g[p++];return v}}}function $(c){var d=j(c);if(d)return d;throw new Error(`Non-${e} character`)}return{encode:S,decodeUnsafe:j,decode:$}}var Vt=It,qt=Vt;let Wt=class{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Qt=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ye(this,e)}},Jt=class{decoders;constructor(e){this.decoders=e}or(e){return Ye(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r!=null)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Ye(n,e){return new Jt({...n.decoders??{[n.prefix]:n},...e.decoders??{[e.prefix]:e}})}let Gt=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Wt(e,t,r),this.decoder=new Qt(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function se({name:n,prefix:e,encode:t,decode:r}){return new Gt(n,e,t,r)}function X({name:n,prefix:e,alphabet:t}){const{encode:r,decode:s}=qt(t,n);return se({prefix:e,name:n,encode:r,decode:o=>ve(s(o))})}function Kt(n,e,t,r){const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let o=n.length;for(;n[o-1]==="=";)--o;const a=new Uint8Array(o*t/8|0);let i=0,h=0,m=0;for(let l=0;l<o;++l){const S=s[n[l]];if(S===void 0)throw new SyntaxError(`Non-${r} character`);h=h<<t|S,i+=t,i>=8&&(i-=8,a[m++]=255&h>>i)}if(i>=t||255&h<<8-i)throw new SyntaxError("Unexpected end of data");return a}function Xt(n,e,t){const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",a=0,i=0;for(let h=0;h<n.length;++h)for(i=i<<8|n[h],a+=8;a>t;)a-=t,o+=e[s&i>>a];if(a!==0&&(o+=e[s&i<<t-a]),r)for(;o.length*t&7;)o+="=";return o}function O({name:n,prefix:e,bitsPerChar:t,alphabet:r}){return se({prefix:e,name:n,encode(s){return Xt(s,r,t)},decode(s){return Kt(s,r,t,n)}})}const D=X({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Yt=X({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Zt=Object.freeze(Object.defineProperty({__proto__:null,base58btc:D,base58flickr:Yt},Symbol.toStringTag,{value:"Module"})),V=O({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ht=O({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),en=O({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),tn=O({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),nn=O({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),rn=O({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),sn=O({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),on=O({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),an=O({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),cn=Object.freeze(Object.defineProperty({__proto__:null,base32:V,base32hex:nn,base32hexpad:sn,base32hexpadupper:on,base32hexupper:rn,base32pad:en,base32padupper:tn,base32upper:Ht,base32z:an},Symbol.toStringTag,{value:"Module"}));var hn=Ze,Ue=128,dn=127,ln=~dn,un=Math.pow(2,31);function Ze(n,e,t){e=e||[],t=t||0;for(var r=t;n>=un;)e[t++]=n&255|Ue,n/=128;for(;n&ln;)e[t++]=n&255|Ue,n>>>=7;return e[t]=n|0,Ze.bytes=t-r+1,e}var fn=ue,pn=128,je=127;function ue(n,r){var t=0,r=r||0,s=0,o=r,a,i=n.length;do{if(o>=i)throw ue.bytes=0,new RangeError("Could not decode varint");a=n[o++],t+=s<28?(a&je)<<s:(a&je)*Math.pow(2,s),s+=7}while(a>=pn);return ue.bytes=o-r,t}var bn=Math.pow(2,7),gn=Math.pow(2,14),wn=Math.pow(2,21),yn=Math.pow(2,28),mn=Math.pow(2,35),vn=Math.pow(2,42),En=Math.pow(2,49),_n=Math.pow(2,56),xn=Math.pow(2,63),Sn=function(n){return n<bn?1:n<gn?2:n<wn?3:n<yn?4:n<mn?5:n<vn?6:n<En?7:n<_n?8:n<xn?9:10},$n={encode:hn,decode:fn,encodingLength:Sn},te=$n;function fe(n,e=0){return[te.decode(n,e),te.decode.bytes]}function ne(n,e,t=0){return te.encode(n,e,t),e}function re(n){return te.encodingLength(n)}function An(n,e){const t=e.byteLength,r=re(n),s=r+re(t),o=new Uint8Array(s+t);return ne(n,o,0),ne(t,o,r),o.set(e,s),new Ee(n,t,e,o)}function He(n){const e=ve(n),[t,r]=fe(e),[s,o]=fe(e.subarray(r)),a=e.subarray(r+o);if(a.byteLength!==s)throw new Error("Incorrect length");return new Ee(t,s,a,e)}function On(n,e){if(n===e)return!0;{const t=e;return n.code===t.code&&n.size===t.size&&t.bytes instanceof Uint8Array&&Nt(n.bytes,t.bytes)}}class Ee{code;size;digest;bytes;constructor(e,t,r,s){this.code=e,this.size=t,this.digest=r,this.bytes=s}}function Pe(n,e){const{bytes:t,version:r}=n;switch(r){case 0:return Tn(t,pe(n),e??D.encoder);default:return kn(t,pe(n),e??V.encoder)}}const ze=new WeakMap;function pe(n){const e=ze.get(n);if(e==null){const t=new Map;return ze.set(n,t),t}return e}class A{code;version;multihash;bytes;"/";constructor(e,t,r,s){this.code=t,this.version=e,this.multihash=r,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Q)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Un)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return A.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=An(e,t);return A.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return A.equals(this,e)}static equals(e,t){const r=t;return r!=null&&e.code===r.code&&e.version===r.version&&On(e.multihash,r.multihash)}toString(e){return Pe(this,e)}toJSON(){return{"/":Pe(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof A)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:r,code:s,multihash:o,bytes:a}=t;return new A(r,s,o,a??Me(r,s,o.bytes))}else if(t[jn]===!0){const{version:r,multihash:s,code:o}=t,a=He(s);return A.create(r,o,a)}else return null}static create(e,t,r){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Q)throw new Error(`Version 0 CID must use dag-pb (code: ${Q}) block encoding`);return new A(e,t,r,r.bytes)}case 1:{const s=Me(e,t,r.bytes);return new A(e,t,r,s)}default:throw new Error("Invalid version")}}static createV0(e){return A.create(0,Q,e)}static createV1(e,t){return A.create(1,e,t)}static decode(e){const[t,r]=A.decodeFirst(e);if(r.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=A.inspectBytes(e),r=t.size-t.multihashSize,s=ve(e.subarray(r,r+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const o=s.subarray(t.multihashSize-t.digestSize),a=new Ee(t.multihashCode,t.digestSize,o,s);return[t.version===0?A.createV0(a):A.createV1(t.codec,a),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[S,j]=fe(e.subarray(t));return t+=j,S};let s=r(),o=Q;if(s===18?(s=0,t=0):o=r(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const a=t,i=r(),h=r(),m=t+h,l=m-a;return{version:s,codec:o,multihashCode:i,digestSize:h,multihashSize:l,size:m}}static parse(e,t){const[r,s]=Cn(e,t),o=A.decode(s);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return pe(o).set(r,e),o}}function Cn(n,e){switch(n[0]){case"Q":{const t=e??D;return[D.prefix,t.decode(`${D.prefix}${n}`)]}case D.prefix:{const t=e??D;return[D.prefix,t.decode(n)]}case V.prefix:{const t=e??V;return[V.prefix,t.decode(n)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[n[0],e.decode(n)]}}}function Tn(n,e,t){const{prefix:r}=t;if(r!==D.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(r);if(s==null){const o=t.encode(n).slice(1);return e.set(r,o),o}else return s}function kn(n,e,t){const{prefix:r}=t,s=e.get(r);if(s==null){const o=t.encode(n);return e.set(r,o),o}else return s}const Q=112,Un=18;function Me(n,e,t){const r=re(n),s=r+re(e),o=new Uint8Array(s+t.byteLength);return ne(n,o,0),ne(e,o,r),o.set(t,s),o}const jn=Symbol.for("@ipld/js-cid/CID");function Pn(n){if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")}function zn(n){return new TextEncoder().encode(n)}function Mn(n){return new TextDecoder().decode(n)}function Ln(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<n.length;s++){var o=n.charAt(s),a=o.charCodeAt(0);if(t[a]!==255)throw new TypeError(o+" is ambiguous");t[a]=s}var i=n.length,h=n.charAt(0),m=Math.log(i)/Math.log(256),l=Math.log(256)/Math.log(i);function S(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";for(var d=0,E=0,f=0,b=c.length;f!==b&&c[f]===0;)f++,d++;for(var g=(b-f)*l+1>>>0,u=new Uint8Array(g);f!==b;){for(var w=c[f],_=0,p=g-1;(w!==0||_<E)&&p!==-1;p--,_++)w+=256*u[p]>>>0,u[p]=w%i>>>0,w=w/i>>>0;if(w!==0)throw new Error("Non-zero carry");E=_,f++}for(var v=g-E;v!==g&&u[v]===0;)v++;for(var P=h.repeat(d);v<g;++v)P+=n.charAt(u[v]);return P}function j(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;var d=0;if(c[d]!==" "){for(var E=0,f=0;c[d]===h;)E++,d++;for(var b=(c.length-d)*m+1>>>0,g=new Uint8Array(b);c[d];){var u=t[c.charCodeAt(d)];if(u===255)return;for(var w=0,_=b-1;(u!==0||w<f)&&_!==-1;_--,w++)u+=i*g[_]>>>0,g[_]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");f=w,d++}if(c[d]!==" "){for(var p=b-f;p!==b&&g[p]===0;)p++;for(var v=new Uint8Array(E+(b-p)),P=E;p!==b;)v[P++]=g[p++];return v}}}function $(c){var d=j(c);if(d)return d;throw new Error(`Non-${e} character`)}return{encode:S,decodeUnsafe:j,decode:$}}var Rn=Ln,Dn=Rn;let Nn=class{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Fn=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return et(this,e)}},Bn=class{decoders;constructor(e){this.decoders=e}or(e){return et(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r!=null)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function et(n,e){return new Bn({...n.decoders??{[n.prefix]:n},...e.decoders??{[e.prefix]:e}})}let In=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Nn(e,t,r),this.decoder=new Fn(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function oe({name:n,prefix:e,encode:t,decode:r}){return new In(n,e,t,r)}function Y({name:n,prefix:e,alphabet:t}){const{encode:r,decode:s}=Dn(t,n);return oe({prefix:e,name:n,encode:r,decode:o=>Pn(s(o))})}function Vn(n,e,t,r){const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let o=n.length;for(;n[o-1]==="=";)--o;const a=new Uint8Array(o*t/8|0);let i=0,h=0,m=0;for(let l=0;l<o;++l){const S=s[n[l]];if(S===void 0)throw new SyntaxError(`Non-${r} character`);h=h<<t|S,i+=t,i>=8&&(i-=8,a[m++]=255&h>>i)}if(i>=t||255&h<<8-i)throw new SyntaxError("Unexpected end of data");return a}function qn(n,e,t){const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",a=0,i=0;for(let h=0;h<n.length;++h)for(i=i<<8|n[h],a+=8;a>t;)a-=t,o+=e[s&i>>a];if(a!==0&&(o+=e[s&i<<t-a]),r)for(;o.length*t&7;)o+="=";return o}function C({name:n,prefix:e,bitsPerChar:t,alphabet:r}){return oe({prefix:e,name:n,encode(s){return qn(s,r,t)},decode(s){return Vn(s,r,t,n)}})}const Wn=Y({prefix:"9",name:"base10",alphabet:"0123456789"}),Qn=Object.freeze(Object.defineProperty({__proto__:null,base10:Wn},Symbol.toStringTag,{value:"Module"})),Jn=C({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Gn=C({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Kn=Object.freeze(Object.defineProperty({__proto__:null,base16:Jn,base16upper:Gn},Symbol.toStringTag,{value:"Module"})),Xn=C({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Yn=Object.freeze(Object.defineProperty({__proto__:null,base2:Xn},Symbol.toStringTag,{value:"Module"})),tt=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Zn=tt.reduce((n,e,t)=>(n[t]=e,n),[]),Hn=tt.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]);function er(n){return n.reduce((e,t)=>(e+=Zn[t],e),"")}function tr(n){const e=[];for(const t of n){const r=Hn[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const nr=oe({prefix:"🚀",name:"base256emoji",encode:er,decode:tr}),rr=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:nr},Symbol.toStringTag,{value:"Module"})),sr=C({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),or=C({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ir=C({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ar=C({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),cr=C({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),hr=C({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),dr=C({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),lr=C({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ur=C({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),fr=Object.freeze(Object.defineProperty({__proto__:null,base32:sr,base32hex:cr,base32hexpad:dr,base32hexpadupper:lr,base32hexupper:hr,base32pad:ir,base32padupper:ar,base32upper:or,base32z:ur},Symbol.toStringTag,{value:"Module"})),pr=Y({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),br=Y({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),gr=Object.freeze(Object.defineProperty({__proto__:null,base36:pr,base36upper:br},Symbol.toStringTag,{value:"Module"})),wr=Y({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),yr=Y({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),mr=Object.freeze(Object.defineProperty({__proto__:null,base58btc:wr,base58flickr:yr},Symbol.toStringTag,{value:"Module"})),vr=C({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Er=C({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),_r=C({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),xr=C({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Sr=Object.freeze(Object.defineProperty({__proto__:null,base64:vr,base64pad:Er,base64url:_r,base64urlpad:xr},Symbol.toStringTag,{value:"Module"})),$r=C({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Ar=Object.freeze(Object.defineProperty({__proto__:null,base8:$r},Symbol.toStringTag,{value:"Module"})),Or=oe({prefix:"\0",name:"identity",encode:n=>Mn(n),decode:n=>zn(n)}),Cr=Object.freeze(Object.defineProperty({__proto__:null,identity:Or},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Le={...Cr,...Yn,...Ar,...Qn,...Kn,...fr,...gr,...mr,...Sr,...rr};function nt(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}const Re=nt("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),ce=nt("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=Xe(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),rt={utf8:Re,"utf-8":Re,hex:Le.base16,latin1:ce,ascii:ce,binary:ce,...Le};function N(n,e="utf8"){const t=rt[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):t.encoder.encode(n).substring(1)}const Tr=Math.pow(2,7),kr=Math.pow(2,14),Ur=Math.pow(2,21),_e=Math.pow(2,28),xe=Math.pow(2,35),Se=Math.pow(2,42),$e=Math.pow(2,49),y=128,U=127;function F(n){if(n<Tr)return 1;if(n<kr)return 2;if(n<Ur)return 3;if(n<_e)return 4;if(n<xe)return 5;if(n<Se)return 6;if(n<$e)return 7;if(Number.MAX_SAFE_INTEGER!=null&&n>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function jr(n,e,t=0){switch(F(n)){case 8:e[t++]=n&255|y,n/=128;case 7:e[t++]=n&255|y,n/=128;case 6:e[t++]=n&255|y,n/=128;case 5:e[t++]=n&255|y,n/=128;case 4:e[t++]=n&255|y,n>>>=7;case 3:e[t++]=n&255|y,n>>>=7;case 2:e[t++]=n&255|y,n>>>=7;case 1:{e[t++]=n&255,n>>>=7;break}default:throw new Error("unreachable")}return e}function Pr(n,e,t=0){switch(F(n)){case 8:e.set(t++,n&255|y),n/=128;case 7:e.set(t++,n&255|y),n/=128;case 6:e.set(t++,n&255|y),n/=128;case 5:e.set(t++,n&255|y),n/=128;case 4:e.set(t++,n&255|y),n>>>=7;case 3:e.set(t++,n&255|y),n>>>=7;case 2:e.set(t++,n&255|y),n>>>=7;case 1:{e.set(t++,n&255),n>>>=7;break}default:throw new Error("unreachable")}return e}function zr(n,e){let t=n[e],r=0;if(r+=t&U,t<y||(t=n[e+1],r+=(t&U)<<7,t<y)||(t=n[e+2],r+=(t&U)<<14,t<y)||(t=n[e+3],r+=(t&U)<<21,t<y)||(t=n[e+4],r+=(t&U)*_e,t<y)||(t=n[e+5],r+=(t&U)*xe,t<y)||(t=n[e+6],r+=(t&U)*Se,t<y)||(t=n[e+7],r+=(t&U)*$e,t<y))return r;throw new RangeError("Could not decode varint")}function Mr(n,e){let t=n.get(e),r=0;if(r+=t&U,t<y||(t=n.get(e+1),r+=(t&U)<<7,t<y)||(t=n.get(e+2),r+=(t&U)<<14,t<y)||(t=n.get(e+3),r+=(t&U)<<21,t<y)||(t=n.get(e+4),r+=(t&U)*_e,t<y)||(t=n.get(e+5),r+=(t&U)*xe,t<y)||(t=n.get(e+6),r+=(t&U)*Se,t<y)||(t=n.get(e+7),r+=(t&U)*$e,t<y))return r;throw new RangeError("Could not decode varint")}function ie(n,e,t=0){return e==null&&(e=Xe(F(n))),e instanceof Uint8Array?jr(n,e,t):Pr(n,e,t)}function Z(n,e=0){return n instanceof Uint8Array?zr(n,e):Mr(n,e)}const Lr=X({prefix:"9",name:"base10",alphabet:"0123456789"}),Rr=Object.freeze(Object.defineProperty({__proto__:null,base10:Lr},Symbol.toStringTag,{value:"Module"})),Dr=O({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Nr=O({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Fr=Object.freeze(Object.defineProperty({__proto__:null,base16:Dr,base16upper:Nr},Symbol.toStringTag,{value:"Module"})),Br=O({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ir=Object.freeze(Object.defineProperty({__proto__:null,base2:Br},Symbol.toStringTag,{value:"Module"})),st=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Vr=st.reduce((n,e,t)=>(n[t]=e,n),[]),qr=st.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]);function Wr(n){return n.reduce((e,t)=>(e+=Vr[t],e),"")}function Qr(n){const e=[];for(const t of n){const r=qr[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const Jr=se({prefix:"🚀",name:"base256emoji",encode:Wr,decode:Qr}),Gr=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Jr},Symbol.toStringTag,{value:"Module"})),Kr=X({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Xr=X({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Yr=Object.freeze(Object.defineProperty({__proto__:null,base36:Kr,base36upper:Xr},Symbol.toStringTag,{value:"Module"})),Zr=O({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Hr=O({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),es=O({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ts=O({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ns=Object.freeze(Object.defineProperty({__proto__:null,base64:Zr,base64pad:Hr,base64url:es,base64urlpad:ts},Symbol.toStringTag,{value:"Module"})),rs=O({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ss=Object.freeze(Object.defineProperty({__proto__:null,base8:rs},Symbol.toStringTag,{value:"Module"})),os=se({prefix:"\0",name:"identity",encode:n=>Bt(n),decode:n=>Ft(n)}),is=Object.freeze(Object.defineProperty({__proto__:null,identity:os},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const as={...is,...Ir,...ss,...Rr,...Fr,...cn,...Yr,...Zt,...ns,...Gr};function ot(n,e="utf8"){const t=rt[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Lt(globalThis.Buffer.from(n,"utf-8")):t.decoder.decode(`${t.prefix}${n}`)}const De=Et,cs=_t,it=function(n){let e=0;if(n=n.toString().trim(),De(n)){const t=new Uint8Array(e+4);return n.split(/\./g).forEach(r=>{t[e++]=parseInt(r,10)&255}),t}if(cs(n)){const t=n.split(":",8);let r;for(r=0;r<t.length;r++){const o=De(t[r]);let a;o&&(a=it(t[r]),t[r]=N(a.slice(0,2),"base16")),a!=null&&++r<8&&t.splice(r,0,N(a.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(r=0;r<t.length&&t[r]!=="";r++);const o=[r,1];for(r=9-t.length;r>0;r--)o.push("0");t.splice.apply(t,o)}const s=new Uint8Array(e+16);for(r=0;r<t.length;r++){const o=parseInt(t[r],16);s[e++]=o>>8&255,s[e++]=o&255}return s}throw new Error("invalid ip address")},hs=function(n,e=0,t){e=~~e,t=t??n.length-e;const r=new DataView(n.buffer);if(t===4){const s=[];for(let o=0;o<t;o++)s.push(n[e+o]);return s.join(".")}if(t===16){const s=[];for(let o=0;o<t;o+=2)s.push(r.getUint16(e+o).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},z=-1,K={},be={},ds=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,z,"ip6zone"],[43,8,"ipcidr"],[53,z,"dns",!0],[54,z,"dns4",!0],[55,z,"dns6",!0],[56,z,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,z,"unix",!1,!0],[421,z,"ipfs"],[421,z,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,z,"garlic64"],[448,0,"tls"],[449,z,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,z,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,z,"memory"]];ds.forEach(n=>{const e=ls(...n);be[e.code]=e,K[e.name]=e});function ls(n,e,t,r,s){return{code:n,size:e,name:t,resolvable:!!r,path:!!s}}function x(n){if(typeof n=="number"){if(be[n]!=null)return be[n];throw new Error(`no protocol with code: ${n}`)}else if(typeof n=="string"){if(K[n]!=null)return K[n];throw new Error(`no protocol with name: ${n}`)}throw new Error(`invalid protocol id type: ${typeof n}`)}x("ip4");x("ip6");x("ipcidr");function at(n,e){switch(x(n).code){case 4:case 41:return fs(e);case 42:return Ie(e);case 6:case 273:case 33:case 132:return ct(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Ie(e);case 421:return ws(e);case 444:return Ve(e);case 445:return Ve(e);case 466:return gs(e);default:return N(e,"base16")}}function Ne(n,e){switch(x(n).code){case 4:return Fe(e);case 41:return Fe(e);case 42:return Be(e);case 6:case 273:case 33:case 132:return Ae(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Be(e);case 421:return ps(e);case 444:return ys(e);case 445:return ms(e);case 466:return bs(e);default:return ot(e,"base16")}}const he=Object.values(as).map(n=>n.decoder),us=function(){let n=he[0].or(he[1]);return he.slice(2).forEach(e=>n=n.or(e)),n}();function Fe(n){if(!Ge(n))throw new Error("invalid ip address");return it(n)}function fs(n){const e=hs(n,0,n.length);if(e==null)throw new Error("ipBuff is required");if(!Ge(e))throw new Error("invalid ip address");return e}function Ae(n){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,n),new Uint8Array(e)}function ct(n){return new DataView(n.buffer).getUint16(n.byteOffset)}function Be(n){const e=ot(n),t=Uint8Array.from(ie(e.length));return q([t,e],t.length+e.length)}function Ie(n){const e=Z(n);if(n=n.slice(F(e)),n.length!==e)throw new Error("inconsistent lengths");return N(n)}function ps(n){let e;n[0]==="Q"||n[0]==="1"?e=He(D.decode(`z${n}`)).bytes:e=A.parse(n).multihash.bytes;const t=Uint8Array.from(ie(e.length));return q([t,e],t.length+e.length)}function bs(n){const e=us.decode(n),t=Uint8Array.from(ie(e.length));return q([t,e],t.length+e.length)}function gs(n){const e=Z(n),t=n.slice(F(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+N(t,"base64url")}function ws(n){const e=Z(n),t=n.slice(F(e));if(t.length!==e)throw new Error("inconsistent lengths");return N(t,"base58btc")}function ys(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=V.decode("b"+e[0]),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=Ae(r);return q([t,s],t.length+s.length)}function ms(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=V.decode(`b${e[0]}`),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=Ae(r);return q([t,s],t.length+s.length)}function Ve(n){const e=n.slice(0,n.length-2),t=n.slice(n.length-2),r=N(e,"base32"),s=ct(t);return`${r}:${s}`}function vs(n){n=ge(n);const e=[],t=[];let r=null;const s=n.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let o=0;o<s.length;o++){const a=s[o],i=x(a);if(i.size===0){e.push([i.code]),t.push([i.code]);continue}if(o++,o>=s.length)throw lt("invalid address: "+n);if(i.path===!0){r=ge(s.slice(o).join("/")),e.push([i.code,Ne(i.code,r)]),t.push([i.code,r]);break}const h=Ne(i.code,s[o]);e.push([i.code,h]),t.push([i.code,at(i.code,h)])}return{string:ht(t),bytes:dt(e),tuples:e,stringTuples:t,path:r}}function qe(n){const e=[],t=[];let r=null,s=0;for(;s<n.length;){const o=Z(n,s),a=F(o),i=x(o),h=Es(i,n.slice(s+a));if(h===0){e.push([o]),t.push([o]),s+=a;continue}const m=n.slice(s+a,s+a+h);if(s+=h+a,s>n.length)throw lt("Invalid address Uint8Array: "+N(n,"base16"));e.push([o,m]);const l=at(o,m);if(t.push([o,l]),i.path===!0){r=l;break}}return{bytes:Uint8Array.from(n),string:ht(t),tuples:e,stringTuples:t,path:r}}function ht(n){const e=[];return n.map(t=>{const r=x(t[0]);return e.push(r.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),ge(e.join("/"))}function dt(n){return q(n.map(e=>{const t=x(e[0]);let r=Uint8Array.from(ie(t.code));return e.length>1&&e[1]!=null&&(r=q([r,e[1]])),r}))}function Es(n,e){if(n.size>0)return n.size/8;if(n.size===0)return 0;{const t=Z(e instanceof Uint8Array?e:Uint8Array.from(e));return t+F(t)}}function ge(n){return"/"+n.trim().split("/").filter(e=>e).join("/")}function lt(n){return new Error("Error parsing address: "+n)}const _s=Symbol.for("nodejs.util.inspect.custom"),ut=Symbol.for("@multiformats/js-multiaddr/multiaddr"),xs=[x("dns").code,x("dns4").code,x("dns6").code,x("dnsaddr").code];class I{bytes;#t;#e;#n;#r;[ut]=!0;constructor(e){e==null&&(e="");let t;if(e instanceof Uint8Array)t=qe(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=vs(e)}else if(ft(e))t=qe(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,this.#t=t.string,this.#e=t.tuples,this.#n=t.stringTuples,this.#r=t.path}toString(){return this.#t}toJSON(){return this.toString()}toOptions(){let e,t,r,s,o="";const a=x("tcp"),i=x("udp"),h=x("ip4"),m=x("ip6"),l=x("dns6"),S=x("ip6zone");for(const[$,c]of this.stringTuples())$===S.code&&(o=`%${c??""}`),xs.includes($)&&(t=a.name,s=443,r=`${c??""}${o}`,e=$===l.code?6:4),($===a.code||$===i.code)&&(t=x($).name,s=parseInt(c??"")),($===h.code||$===m.code)&&(t=x($).name,r=`${c??""}${o}`,e=$===m.code?6:4);if(e==null||t==null||r==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:s}}protos(){return this.#e.map(([e])=>Object.assign({},x(e)))}protoCodes(){return this.#e.map(([e])=>e)}protoNames(){return this.#e.map(([e])=>x(e).name)}tuples(){return this.#e}stringTuples(){return this.#n}encapsulate(e){return e=new I(e),new I(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),s=r.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new I(r.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new I(dt(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([r,s])=>{r===K.p2p.code&&e.push([r,s]),r===K["p2p-circuit"].code&&(e=[])});const t=e.pop();if(t?.[1]!=null){const r=t[1];return r[0]==="Q"||r[0]==="1"?N(D.decode(`z${r}`),"base58btc"):N(A.parse(r).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return this.#r}equals(e){return xt(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(o=>o.resolvable);if(t==null)return[this];const r=Ss.get(t.name);if(r==null)throw new Dt(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map(o=>new I(o))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[_s](){return`Multiaddr(${this.#t})`}}const Ss=new Map;function $s(n){return ft(n)?n.protos().some(e=>e.resolvable):!1}function ft(n){return!!n?.[ut]}function pt(n){return new I(n)}const We=421,As=290,Os=2e3;function Cs(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=St(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+e,r.href=r.protocol+"://"+o+(t&&t.port===r.port?"":":"+r.port),r}function R(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const Ts=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class bt extends Ke{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[R(e,"open",this.onopen.bind(this)),R(e,"packet",this.onpacket.bind(this)),R(e,"error",this.onerror.bind(this)),R(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Ts.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:L.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const a=this.ids++,i=t.pop();this._registerAckCallback(a,i),r.id=a}const s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const s=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(s===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},s);this.acks[e]=(...a)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...a])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((s,o)=>{t.push((a,i)=>r?a?o(a):s(i):s(a)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...o)=>r!==this._queue[0]?void 0:(s!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(s)):(this._queue.shift(),t&&t(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:L.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case L.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case L.EVENT:case L.BINARY_EVENT:this.onevent(e);break;case L.ACK:case L.BINARY_ACK:this.onack(e);break;case L.DISCONNECT:this.ondisconnect();break;case L.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...s){r||(r=!0,t.packet({type:L.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:L.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function W(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}W.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};W.prototype.reset=function(){this.attempts=0};W.prototype.setMin=function(n){this.ms=n};W.prototype.setMax=function(n){this.max=n};W.prototype.setJitter=function(n){this.jitter=n};class we extends Ke{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,$t(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new W({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||At;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Ot(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const s=R(t,"open",function(){r.onopen(),e&&e()}),o=i=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",i),e?e(i):this.maybeReconnectOnOpen()},a=R(t,"error",o);if(this._timeout!==!1){const i=this._timeout,h=this.setTimeoutFn(()=>{s(),o(new Error("timeout")),t.close()},i);this.opts.autoUnref&&h.unref(),this.subs.push(()=>{this.clearTimeoutFn(h)})}return this.subs.push(s),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(R(e,"ping",this.onping.bind(this)),R(e,"data",this.ondata.bind(this)),R(e,"error",this.onerror.bind(this)),R(e,"close",this.onclose.bind(this)),R(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Ct(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new bt(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const J={};function ee(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=Cs(n,e.path||"/socket.io"),r=t.source,s=t.id,o=t.path,a=J[s]&&o in J[s].nsps,i=e.forceNew||e["force new connection"]||e.multiplex===!1||a;let h;return i?h=new we(r,e):(J[s]||(J[s]=new we(r,e)),h=J[s]),t.query&&!e.query&&(e.query=t.queryKey),h.socket(t.path,e)}Object.assign(ee,{Manager:we,Socket:bt,io:ee,connect:ee});const de=ye("libp2p:webrtc-star:socket");function gt(n,e){const{sink:t,source:r}=n,s={remoteAddr:e.remoteAddr,async sink(o){e.signal!=null&&(o=Oe(o,e.signal));try{await t(o)}catch(a){a.type!=="aborted"&&de.error(a)}},source:e.signal!=null?Oe(r,e.signal):r,timeline:{open:Date.now()},async close(){if(n.closed)return;const o=Date.now(),a=setTimeout(()=>{if(s.remoteAddr!=null){const{host:i,port:h}=s.remoteAddr.toOptions();de("timeout closing socket to %s:%s after %dms, destroying it manually",i,h,Date.now()-o)}n.closed||n.close().catch(i=>{de.error("could not close socket",i)})},Os);try{await n.close()}finally{clearTimeout(a)}}};return n.addEventListener("close",()=>{s.timeline.close==null&&(s.timeline.close=Date.now())},{once:!0}),s}function wt(n){const e=n.toString().split("/"),t=n.protos()[1].name,r=n.protos()[2].name,s=n.stringTuples()[1][1];if(t!=="tcp"||r!=="ws"&&r!=="wss")throw new Error(`invalid multiaddr: ${n.toString()}`);if(!$s(n))return`http://${e[2]}:${e[4]}`;if(r==="ws")return`http://${e[2]}${s==null||s==="80"?"":`:${s}`}`;if(r==="wss")return`https://${e[2]}${s==null||s==="443"?"":`:${s}`}`;throw new Error("invalid multiaddr: "+n.toString())}function ks(n){const e="/libp2p-webrtc-star";if(n.startsWith(e)){n=n.substring(e.length,n.length);let t=pt(n);const r=t.stringTuples().filter(s=>s[0]===421)[0];if(r[1]==null)throw new Error("invalid multiaddr: "+n);t=t.decapsulate("p2p"),t=t.encapsulate("/p2p-webrtc-star"),t=t.encapsulate(`/p2p/${r[1]}`),n=t.toString()}return n}const k=ye("libp2p:webrtc-star:listener"),Us={transports:["websocket"],path:"/socket.io-next/"};class js extends me{constructor(e,t,r,s,o){super(),this.signallingAddr=t,this.socket=ee(e,Us),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=r,this.handler=s,this.channelOptions=o,this.handleWsHandshake=this.handleWsHandshake.bind(this);let a=!1;this.socket.on("connect_error",i=>{a&&i.type==="TransportError"||this.dispatchEvent(new M("error",{detail:i}))}),this.socket.on("error",i=>{this.dispatchEvent(new M("error",{detail:i}))}),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",i=>{this.dispatchEvent(new M("peer",{detail:i}))}),this.socket.on("connect",()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),a&&this.dispatchEvent(new M("reconnect"))}),this.socket.once("connect",()=>{a=!0,this.dispatchEvent(new M("listening"))}),this.socket.on("disconnect",()=>{this.dispatchEvent(new M("disconnect"))})}_createChannel(e,t,r){const s={...this.channelOptions},o=new Tt(s),a=i=>{const h=i.detail;k.error("incoming connection errored",h)};return o.addEventListener("error",a),o.addEventListener("close",()=>{o.removeEventListener("error",a)},{once:!0}),o.addEventListener("signal",i=>{const h=i.detail;this.socket.emit("ss-handshake",{intentId:e,srcMultiaddr:t,dstMultiaddr:r,answer:!0,signal:h})}),o.addEventListener("ready",()=>{const i=gt(o,{remoteAddr:this.signallingAddr});k("new inbound connection %s",i.remoteAddr);try{this.upgrader.upgradeInbound(i).then(h=>{k("inbound connection %s upgraded",i.remoteAddr),this.connections.push(i);const m=()=>{this.connections=this.connections.filter(l=>l!==i),this.channels.delete(e),this.pendingSignals.delete(e)};o.addEventListener("close",m,{once:!0}),this.dispatchEvent(new M("connection",{detail:h})),this.handler(h)}).catch(h=>{k.error("inbound connection failed to upgrade",h),i.close().catch(m=>{k.error("inbound connection failed to close after failing to upgrade",m)})})}catch(h){k.error("inbound connection failed to upgrade",h),i.close().catch(m=>{k.error("inbound connection failed to close after failing to upgrade",m)})}},{once:!0}),o}handleWsHandshake(e){if(k('incoming handshake. signal type "%s" is answer %s',e.signal.type,e.answer),e.answer===!0||e.err!=null||e.intentId==null)return;const t=e.intentId;let r=this.pendingSignals.get(t);r==null&&(r=[],this.pendingSignals.set(t,r)),r.push(e);let s=this.channels.get(t);if(s==null){if(e.signal.type!=="offer"){k("handshake is not an offer and channel does not exist, buffering until we receive an offer");return}k("creating new channel to handle offer handshake"),s=this._createChannel(e.intentId,e.srcMultiaddr,e.dstMultiaddr),this.channels.set(t,s)}else k("channel already exists, using it to handle handshake");for(;r.length>0;){const o=r.shift();o?.signal!=null&&s.handleSignal(o.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map(async e=>{await e.close()}),...Array.from(this.channels.values()).map(async e=>{await e.close()})]),this.dispatchEvent(new M("close"))}}class Ps extends me{constructor(e,t,r,s,o){super(),this.upgrader=e,this.handler=t,this.peerId=r,this.transport=s,this.options=o}async listen(e){if(this.listeningAddr!=null)throw G(new Error("listener already in use"),"ERR_ALREADY_LISTENING");const t=Rt();this.listeningAddr=e;let r;e.protoCodes().includes(We)?r=e:r=e.encapsulate(`/p2p/${this.peerId.toString()}`);const s=this.signallingUrl=wt(e);k("connecting to signalling server on: %s",this.signallingUrl);const o=new js(this.signallingUrl,r,this.upgrader,this.handler,this.options.channelOptions);o.addEventListener("error",a=>{const i=a.detail;k("error connecting to signalling server %o",i),o.close().catch(h=>{k.error("error closing server after error",h)}),t.reject(i)}),o.addEventListener("listening",()=>{k("connected to signalling server"),this.dispatchEvent(new M("listening")),t.resolve()}),o.addEventListener("peer",a=>{this.transport.peerDiscovered(a.detail)}),o.addEventListener("connection",a=>{const i=a.detail;if(i.remoteAddr==null)try{i.remoteAddr=e.decapsulateCode(We).encapsulate(`/p2p/${i.remotePeer.toString()}`)}catch(h){k.error("could not determine remote address",h)}this.dispatchEvent(new M("connection",{detail:i}))}),o.addEventListener("disconnect",()=>{this.transport.sigServers.delete(s)}),o.addEventListener("reconnect",()=>{this.transport.sigServers.set(s,o)}),this.transport.sigServers.set(this.signallingUrl,o),await t.promise}async close(){if(this.signallingUrl!=null){const e=this.transport.sigServers.get(this.signallingUrl);e!=null&&(await e.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new M("close")),this.listeningAddr=void 0}getAddrs(){return this.listeningAddr!=null?[this.listeningAddr]:[]}}function zs(n,e,t,r,s){return new Ps(n,e,t,r,s)}function Ms(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function Ls(n=0){return globalThis.Buffer?.allocUnsafe!=null?Ms(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function Rs(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<n.length;s++){var o=n.charAt(s),a=o.charCodeAt(0);if(t[a]!==255)throw new TypeError(o+" is ambiguous");t[a]=s}var i=n.length,h=n.charAt(0),m=Math.log(i)/Math.log(256),l=Math.log(256)/Math.log(i);function S(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";for(var d=0,E=0,f=0,b=c.length;f!==b&&c[f]===0;)f++,d++;for(var g=(b-f)*l+1>>>0,u=new Uint8Array(g);f!==b;){for(var w=c[f],_=0,p=g-1;(w!==0||_<E)&&p!==-1;p--,_++)w+=256*u[p]>>>0,u[p]=w%i>>>0,w=w/i>>>0;if(w!==0)throw new Error("Non-zero carry");E=_,f++}for(var v=g-E;v!==g&&u[v]===0;)v++;for(var P=h.repeat(d);v<g;++v)P+=n.charAt(u[v]);return P}function j(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;var d=0;if(c[d]!==" "){for(var E=0,f=0;c[d]===h;)E++,d++;for(var b=(c.length-d)*m+1>>>0,g=new Uint8Array(b);c[d];){var u=t[c.charCodeAt(d)];if(u===255)return;for(var w=0,_=b-1;(u!==0||w<f)&&_!==-1;_--,w++)u+=i*g[_]>>>0,g[_]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");f=w,d++}if(c[d]!==" "){for(var p=b-f;p!==b&&g[p]===0;)p++;for(var v=new Uint8Array(E+(b-p)),P=E;p!==b;)v[P++]=g[p++];return v}}}function $(c){var d=j(c);if(d)return d;throw new Error(`Non-${e} character`)}return{encode:S,decodeUnsafe:j,decode:$}}var Ds=Rs,Ns=Ds;const Fs=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},Bs=n=>new TextEncoder().encode(n),Is=n=>new TextDecoder().decode(n);class Vs{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class qs{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return yt(this,e)}}class Ws{constructor(e){this.decoders=e}or(e){return yt(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const yt=(n,e)=>new Ws({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});class Qs{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Vs(e,t,r),this.decoder=new qs(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ae=({name:n,prefix:e,encode:t,decode:r})=>new Qs(n,e,t,r),H=({prefix:n,name:e,alphabet:t})=>{const{encode:r,decode:s}=Ns(t,e);return ae({prefix:n,name:e,encode:r,decode:o=>Fs(s(o))})},Js=(n,e,t,r)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let o=n.length;for(;n[o-1]==="=";)--o;const a=new Uint8Array(o*t/8|0);let i=0,h=0,m=0;for(let l=0;l<o;++l){const S=s[n[l]];if(S===void 0)throw new SyntaxError(`Non-${r} character`);h=h<<t|S,i+=t,i>=8&&(i-=8,a[m++]=255&h>>i)}if(i>=t||255&h<<8-i)throw new SyntaxError("Unexpected end of data");return a},Gs=(n,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",a=0,i=0;for(let h=0;h<n.length;++h)for(i=i<<8|n[h],a+=8;a>t;)a-=t,o+=e[s&i>>a];if(a&&(o+=e[s&i<<t-a]),r)for(;o.length*t&7;)o+="=";return o},T=({name:n,prefix:e,bitsPerChar:t,alphabet:r})=>ae({prefix:e,name:n,encode(s){return Gs(s,r,t)},decode(s){return Js(s,r,t,n)}}),Ks=H({prefix:"9",name:"base10",alphabet:"0123456789"}),Xs=Object.freeze(Object.defineProperty({__proto__:null,base10:Ks},Symbol.toStringTag,{value:"Module"})),Ys=T({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Zs=T({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Hs=Object.freeze(Object.defineProperty({__proto__:null,base16:Ys,base16upper:Zs},Symbol.toStringTag,{value:"Module"})),eo=T({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),to=Object.freeze(Object.defineProperty({__proto__:null,base2:eo},Symbol.toStringTag,{value:"Module"})),mt=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),no=mt.reduce((n,e,t)=>(n[t]=e,n),[]),ro=mt.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]);function so(n){return n.reduce((e,t)=>(e+=no[t],e),"")}function oo(n){const e=[];for(const t of n){const r=ro[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const io=ae({prefix:"🚀",name:"base256emoji",encode:so,decode:oo}),ao=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:io},Symbol.toStringTag,{value:"Module"})),co=T({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ho=T({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),lo=T({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),uo=T({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),fo=T({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),po=T({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bo=T({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),go=T({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),wo=T({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),yo=Object.freeze(Object.defineProperty({__proto__:null,base32:co,base32hex:fo,base32hexpad:bo,base32hexpadupper:go,base32hexupper:po,base32pad:lo,base32padupper:uo,base32upper:ho,base32z:wo},Symbol.toStringTag,{value:"Module"})),mo=H({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),vo=H({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Eo=Object.freeze(Object.defineProperty({__proto__:null,base36:mo,base36upper:vo},Symbol.toStringTag,{value:"Module"})),_o=H({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),xo=H({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),So=Object.freeze(Object.defineProperty({__proto__:null,base58btc:_o,base58flickr:xo},Symbol.toStringTag,{value:"Module"})),$o=T({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ao=T({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Oo=T({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Co=T({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),To=Object.freeze(Object.defineProperty({__proto__:null,base64:$o,base64pad:Ao,base64url:Oo,base64urlpad:Co},Symbol.toStringTag,{value:"Module"})),ko=T({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Uo=Object.freeze(Object.defineProperty({__proto__:null,base8:ko},Symbol.toStringTag,{value:"Module"})),jo=ae({prefix:"\0",name:"identity",encode:n=>Is(n),decode:n=>Bs(n)}),Po=Object.freeze(Object.defineProperty({__proto__:null,identity:jo},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Qe={...Po,...to,...Uo,...Xs,...Hs,...yo,...Eo,...So,...To,...ao};function vt(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}const Je=vt("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),le=vt("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=Ls(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),zo={utf8:Je,"utf-8":Je,hex:Qe.base16,latin1:le,ascii:le,binary:le,...Qe};function Mo(n,e="utf8"){const t=zo[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):t.encoder.encode(n).substring(1)}const Lo="RTCPeerConnection"in globalThis,B=ye("libp2p:webrtc-star"),Ro=()=>{};class Do extends me{constructor(){super(...arguments),this.started=!1}get[Mt](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(e){return this.isStarted()?super.dispatchEvent(e):!1}}class No{constructor(e){e?.wrtc!=null&&(this.wrtc=e.wrtc),this.sigServers=new Map,this._discovery=new Do,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[kt](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(e,t){const r=await this._connect(e,t),s=gt(r,{remoteAddr:e,signal:t.signal});B("new outbound connection %s",s.remoteAddr);const o=await t.upgrader.upgradeOutbound(s);return B("outbound connection %s upgraded",s.remoteAddr),o}async _connect(e,t){if(t.signal?.aborted===!0)throw new Ce;const r={...t.channelOptions??{}};this.wrtc!=null&&(r.wrtc=this.wrtc);const s=e.toOptions(),o=Mo(Ut(36),"hex");return await new Promise((a,i)=>{const h=this.sigServers.get(wt(e));if(h?.socket==null){i(G(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));return}let m=!1;B("dialing %s:%s",s.host,s.port);const l=new jt(r),S=d=>{const E=d.detail;if(!m){const f=`connection error ${s.host}:${s.port}: ${E.message}`;B.error(f),c(E)}},j=()=>{m=!0,B("connection opened %s:%s",s.host,s.port),c()},$=()=>{B.error("connection aborted %s:%s",s.host,s.port),l.close().finally(()=>{c(new Ce)})},c=d=>{l.removeEventListener("ready",j),t.signal?.removeEventListener("abort",$),d==null?a(l):i(d)};l.addEventListener("ready",j,{once:!0}),l.addEventListener("close",()=>{l.removeEventListener("error",S)}),t.signal?.addEventListener("abort",$),l.addEventListener("signal",d=>{const E=d.detail;h.socket.emit("ss-handshake",{intentId:o,srcMultiaddr:h.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:E})}),h.socket.on("ws-handshake",d=>{d.intentId===o&&d.err!=null&&l.close().finally(()=>{i(G(new Error(d.err),"ERR_SIGNALLING_FAILED"))}),!(d.intentId!==o||d.answer==null||l.closed)&&l.handleSignal(d.signal)})})}createListener(e){if(!Lo&&this.wrtc==null)throw G(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(e.channelOptions=e.channelOptions??{},this.wrtc!=null&&(e.channelOptions.wrtc=this.wrtc),this.peerId==null)throw G(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return zs(e.upgrader,e.handler??Ro,this.peerId,this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(As)?!1:Pt.matches(t))}peerDiscovered(e){B("peer discovered: %s",e),e=ks(e);const t=pt(e),r=t.getPeerId();if(r==null)return;const s=zt(r);this._discovery.dispatchEvent(new M("peer",{detail:{id:s,multiaddrs:[t],protocols:[]}}))}}function Xo(n={}){const e=new No(n);return{transport:t=>(e.peerId=t.peerId,e),discovery:e.discovery}}export{Xo as w};
//# sourceMappingURL=index-jo-hhVYV.js.map
