{"version":3,"file":"PageCompte-253abc68.js","sources":["../../src/components/communs/listeNoms/DialogueNoms.vue","../../src/vues/PageCompte.vue"],"sourcesContent":["<template>\n  <v-dialog v-model=\"dialogue\">\n    <template #activator=\"{props}\">\n      <slot\n        name=\"activator\"\n        v-bind=\"{props}\"\n      ></slot>\n    </template>\n    <v-card>\n      <v-card-item>\n        <v-card-title>\n          {{ titre }}\n        </v-card-title>\n        <v-card-subtitle>\n          {{ sousTitre }}\n        </v-card-subtitle>\n      </v-card-item>\n      <v-card-text>\n        <ListeNoms\n          :noms-initiaux=\"nomsInitiaux\"\n          :texte-aucun-nom=\"texteAucunNom\"\n          :indice-langue=\"indiceLangue\"\n          :indice-nom=\"indiceNom\"\n          @ajuster-noms=\"ajusterNoms\"\n        ></ListeNoms>\n      </v-card-text>\n      <v-card-actions>\n        <v-spacer></v-spacer>\n        <v-btn\n          variant=\"text\"\n          @click=\"fermer\"\n        >\n          {{ t('communs.fermer') }}\n        </v-btn>\n\n        <v-btn\n          color=\"primary\"\n          variant=\"flat\"\n          :disabled=\"!nomsChangés\"\n          @click=\"sauvegarder\"\n        >\n          {{ t('communs.sauvegarder') }}\n        </v-btn>\n      </v-card-actions>\n    </v-card>\n  </v-dialog>\n</template>\n<script setup lang=\"ts\">\nimport {computed, ref} from 'vue';\nimport ListeNoms from './ListeNoms.vue';\nimport {கிளிமூக்கை_உபயோகி} from '/@/plugins/kilimukku/kilimukku-vue';\nimport deepEqual from 'deep-equal';\n\nconst {useI18n} = கிளிமூக்கை_உபயோகி();\nconst {t} = useI18n();\n\nconst props = defineProps<{\n  titre: string;\n  sousTitre: string;\n  nomsInitiaux: {[lng: string]: string};\n  indiceNom: string;\n  indiceLangue: string;\n  texteAucunNom: string;\n}>();\nconst emit = defineEmits<{\n  (é: 'ajusterNoms', noms: {[lng: string]: string}): void;\n}>();\n\n// Navigation générale\nconst dialogue = ref(false);\nconst fermer = () => {\n  dialogue.value = false;\n  nomsChoisis.value = props.nomsInitiaux;\n};\nconst sauvegarder = () => {\n  emit('ajusterNoms', nomsChoisis.value);\n  dialogue.value = false;\n};\n\n// Gestion noms\nconst nomsChoisis = ref<{[langue: string]: string}>(props.nomsInitiaux);\nconst ajusterNoms = (noms: {[langue: string]: string}) => {\n  nomsChoisis.value = noms;\n};\nconst nomsChangés = computed(() => {\n  return !deepEqual(nomsChoisis.value, props.nomsInitiaux);\n});\n</script>\n","<template>\n  <v-container class=\"text-center\">\n    <TitrePage :titre=\"$t('pages.compte.titre')\" />\n    <ImageEditable\n      :src-image=\"srcImgProfil\"\n      :img-defaut=\"imgDéfaut\"\n      :taille-avatar=\"mdAndUp ? 275 : 175\"\n      :editable=\"true\"\n      :max-taille-image=\"MAX_TAILLE_IMAGE\"\n      @image-changee=\"image => sauvegarderImage(image)\"\n    />\n    <h1>\n      {{ nomTraduit || $t('communs.anonyme') }}\n      <DialogueNoms\n        :indice-nom=\"$t('listeNomsProfil.indiceNom')\"\n        :indice-langue=\"$t('listeNomsProfil.indiceLangue')\"\n        :texte-aucun-nom=\"$t('listeNomsProfil.texteAucunNom')\"\n        :noms-initiaux=\"noms\"\n        :titre=\"$t('pages.compte.titreDialogueNoms')\"\n        :sous-titre=\"$t('pages.compte.sousTitreDialogueNoms')\"\n        @ajuster-noms=\"noms => ajusterNoms(noms)\"\n      >\n        <template #activator=\"{props}\">\n          <v-btn\n            v-bind=\"props\"\n            icon=\"mdi-pencil\"\n            variant=\"flat\"\n          ></v-btn>\n        </template>\n      </DialogueNoms>\n    </h1>\n  </v-container>\n</template>\n<script setup lang=\"ts\">\nimport {computed, inject, onMounted, onUnmounted, ref} from 'vue';\nimport {useDisplay} from 'vuetify';\nimport {utiliserImagesDéco} from '/@/composables/images';\nimport {கிளிமூக்கை_உபயோகி} from '/@/plugins/kilimukku/kilimukku-vue';\n\nimport type ClientConstellation from '@constl/ipa';\nimport type {schémaFonctionOublier} from '@constl/ipa/dist/src/utils';\n\nimport TitrePage from '../components/communs/TitrePage.vue';\nimport ImageEditable from '/@/components/communs/ImageEditable.vue';\nimport {MAX_TAILLE_IMAGE} from '/@/consts';\nimport {utiliserLangues} from '/@/plugins/localisation/localisation';\nimport DialogueNoms from '../components/communs/listeNoms/DialogueNoms.vue';\n\nconst constl = inject<ClientConstellation>('constl');\n\nconst {useI18n} = கிளிமூக்கை_உபயோகி();\nconst {$t} = useI18n();\nconst {mdAndUp} = useDisplay();\n\n// Image profil\nconst imageProfil = ref<Uint8Array | null>();\nconst srcImgProfil = computed(() => {\n  if (imageProfil.value) {\n    return URL.createObjectURL(new Blob([imageProfil.value], {type: 'image'}));\n  } else {\n    return undefined;\n  }\n});\nlet fOublierImageProfil: schémaFonctionOublier | undefined = undefined;\nonMounted(async () => {\n  fOublierImageProfil = await constl?.profil?.suivreImage({\n    f: image => (imageProfil.value = image),\n  });\n});\nonUnmounted(async () => {\n  if (fOublierImageProfil) await fOublierImageProfil();\n});\nconst {obtImageDéco} = utiliserImagesDéco();\nconst imgDéfaut = obtImageDéco('profil');\n\nconst sauvegarderImage = async (image?: ArrayBuffer) => {\n  if (image) {\n    console.log('ici', {image});\n    await constl?.profil?.sauvegarderImage({image});\n  } else {\n    console.log('là', {image});\n    await constl?.profil?.effacerImage();\n  }\n};\n\n// Nom profil\nconst {traduireNom} = utiliserLangues();\n\nconst noms = ref<{[lng: string]: string}>({});\nconst nomTraduit = traduireNom(noms);\nlet fOublierNoms: (() => Promise<void>) | undefined = undefined;\nonMounted(async () => {\n  fOublierNoms = await constl?.profil?.suivreNoms({\n    f: x => (noms.value = x),\n  });\n});\nonMounted(async () => {\n  if (fOublierNoms) await fOublierNoms();\n});\n\nconst ajusterNoms = async (noms: {[langue: string]: string}) => {\n  for (const [langue, nom] of Object.entries(noms)) {\n    await constl?.profil?.sauvegarderNom({langue, nom});\n  }\n};\n</script>\n"],"names":["useI18n","கிளிமூக்கை_உபயோகி","t","dialogue","ref","fermer","nomsChoisis","props","sauvegarder","emit","ajusterNoms","noms","nomsChangés","computed","deepEqual","constl","inject","$t","mdAndUp","useDisplay","imageProfil","srcImgProfil","fOublierImageProfil","onMounted","image","onUnmounted","obtImageDéco","utiliserImagesDéco","imgDéfaut","sauvegarderImage","traduireNom","utiliserLangues","nomTraduit","fOublierNoms","x","langue","nom"],"mappings":"8iBAqDM,CAAC,QAAAA,GAAWC,IACZ,CAAC,EAAAC,GAAKF,IAeNG,EAAWC,EAAI,EAAK,EACpBC,EAAS,IAAM,CACnBF,EAAS,MAAQ,GACjBG,EAAY,MAAQC,EAAM,YAAA,EAEtBC,EAAc,IAAM,CACnBC,EAAA,cAAeH,EAAY,KAAK,EACrCH,EAAS,MAAQ,EAAA,EAIbG,EAAcF,EAAgCG,EAAM,YAAY,EAChEG,EAAeC,GAAqC,CACxDL,EAAY,MAAQK,CAAA,EAEhBC,EAAcC,EAAS,IACpB,CAACC,EAAUR,EAAY,MAAOC,EAAM,YAAY,CACxD,u5BCtCK,MAAAQ,EAASC,EAA4B,QAAQ,EAE7C,CAAC,QAAAhB,GAAWC,IACZ,CAAC,GAAAgB,GAAMjB,IACP,CAAC,QAAAkB,GAAWC,IAGZC,EAAchB,IACdiB,EAAeR,EAAS,IAAM,CAClC,GAAIO,EAAY,MACd,OAAO,IAAI,gBAAgB,IAAI,KAAK,CAACA,EAAY,KAAK,EAAG,CAAC,KAAM,OAAO,CAAC,CAAC,CAG3E,CACD,EACD,IAAIE,EACJC,EAAU,SAAY,CACED,EAAA,MAAMP,GAAQ,QAAQ,YAAY,CACtD,EAAaS,GAAAJ,EAAY,MAAQI,CAAA,CAClC,CAAA,CACF,EACDC,EAAY,SAAY,CAClBH,GAAqB,MAAMA,EAAoB,CAAA,CACpD,EACK,KAAA,CAAC,aAAAI,GAAgBC,IACjBC,EAAYF,EAAa,QAAQ,EAEjCG,EAAmB,MAAOL,GAAwB,CAClDA,GACF,QAAQ,IAAI,MAAO,CAAC,MAAAA,CAAM,CAAA,EAC1B,MAAMT,GAAQ,QAAQ,iBAAiB,CAAC,MAAAS,CAAM,CAAA,IAE9C,QAAQ,IAAI,KAAM,CAAC,MAAAA,CAAM,CAAA,EACnB,MAAAT,GAAQ,QAAQ,eACxB,EAII,CAAC,YAAAe,GAAeC,IAEhBpB,EAAOP,EAA6B,CAAA,CAAE,EACtC4B,EAAaF,EAAYnB,CAAI,EACnC,IAAIsB,EACJV,EAAU,SAAY,CACLU,EAAA,MAAMlB,GAAQ,QAAQ,WAAW,CAC9C,EAASmB,GAAAvB,EAAK,MAAQuB,CAAA,CACvB,CAAA,CACF,EACDX,EAAU,SAAY,CAChBU,GAAc,MAAMA,EAAa,CAAA,CACtC,EAEK,MAAAvB,EAAc,MAAOC,GAAqC,CAC9D,SAAW,CAACwB,EAAQC,CAAG,IAAK,OAAO,QAAQzB,CAAI,EAC7C,MAAMI,GAAQ,QAAQ,eAAe,CAAC,OAAAoB,EAAQ,IAAAC,EAAI,CACpD"}